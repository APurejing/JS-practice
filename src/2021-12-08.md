# 浏览器工作原理
打开浏览器的的任务管理器，可以看到正在运行中浏览器使用的多个进程信息，打开一个页面实际上使用了多个进程。为探究其原因，先来了解一下进程和线程的概念及它们之间的关系。
## 进程与线程
* **线程**

> 操作系统能够进行运算调度的最小单位。大部分情况下，它被包含在进程之中，是进程中的实际运作单位。一条线程指的是进程中一个单一顺序的控制流，一个进程中可以并发多个线程，每条线程并行执行不同的任务。

假设我们要计算机计算下面三个表达式的值，并显示出结果：
>a = 1 + 2
b = 3 * 4
c = 30 / 5

这个过程可以拆分为四个子任务：
>第一步：计算a = 1 + 2 ；
第二步：计算b = 3 * 4 ；
第三步：计算c = 30 / 5 ；
第四步：显示计算结果 。

假设程序使用单线程处理，则按顺序分别执行这四步。但如果采用多线程，只需分为两步：
>第一步：使用三个线程同时执行前三任务（计算三个表达式的值）；
第二步：执行第四个显示任务。使用并行处理能大大提升性能。

多线程可以并行处理任务，但线程是不能单独存在的，它是由进程来启动和管理的。（⚠️）

* **进程**
  
> 操作系统资源分配的最小单位，程序（指令和数据）的真正执行实例。用户下达指令后，操作系统会为该程序创建一块内存，用来存放代码、运行中的数据和一个执行任务的主线程，这样的一个运行环境叫进程，可以理解为一个容器。

一个进程下可包含一个或者多个线程，在进程中使用多线程并行处理能提升运算效率。

**进程和线程的关系有以下四个特点**：

> 1. 进程中的任意一线程执行出错，都会导致整个进程的崩溃。
> 2. 线程可以共享进程中的数据。线程可以对进程的公共数据进行读写操作。
> 3. 当一个进程关闭之后，操作系统会回收进程所占用的内存。当一个进程退出时，操作系统会回收该进程所申请的所有资源；即使其中任意线程因为操作不当导致内存泄漏，当进程退出时，这些内存也会被正确回收。
> 4. 进程之间的内容相互隔离。进程隔离是为保护操作系统中进程互不干扰的技术，避免一个进程崩溃或挂起影响到其他进程。如果进程之间需要进行数据的通信，就需要使用用于进程间通信（IPC）的机制了。
## 浏览器进化史
### 单进程浏览器
早在2007年之前，市面上的浏览器都是单进程的，浏览器中的所有功能模块都运行在同一个进程里。这些模块包含了网络、插件、 JavaScript运行环境、渲染引擎和页面等，导致单进程浏览器**不稳定、不流畅、不安全**。出现这些问题的原因：

**1. 不稳定**
>早期浏览器借助于插件实现功能，但插件是最容易出问题的模块，并且还运行在浏览器进程之中，所以一个插件的意外崩溃会引起整个浏览器的崩溃。
除了插件之外，渲染引擎模块也是不稳定的，通常一些复杂的 JavaScript 代码就有可能引起渲染引擎模块的崩溃。渲染引擎的崩溃也会导致整个浏览器的崩溃。

**2. 不流畅**
> 单进程执行任务，所有页面的渲染模块、JavaScript 执行环境以及插件都是运行在同一个线程中，这就意味着同一时刻只能有一个模块可以执行。假设有一个无限循环的脚本中页面中运行，便会独占整个线程，导致其它模块都没机会执行，整个浏览器失去相应，变卡顿。
除了脚本或插件外，页面等内存泄漏也是单进程变慢的一个重要原因。通常浏览器的内核都是非常复杂的，运行一个复杂点的页面再关闭页面，会存在内存不能完全回收的情况，导致使用时间越长，内存占用越高，浏览器越慢。

**3. 不安全**
> 页面脚本可以通过浏览器的漏洞来获取系统权限，引发安全性问题。插件可以使用其他语言编写，通过插件可以获取到操作系统的任意资源。如果是个恶意插件，那么它就可以释放病毒、窃取你的账号密码，也会引发安全性问题。

### 早期多进程浏览器
以2008年Chrome发布时的进程架构为例，针对以上单进程浏览器的三方面主要问题进行改进。
