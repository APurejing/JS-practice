# 消息队列和事件循环
每个渲染进程都有一个主线程，**主线程**非常繁忙，**既要处理DOM，又要计算样式，还要处理布局，同时需要处理JavaScript任务以及各种输入事件。**这就需要消息队列和事件循环系统统筹调度这些任务。（理解页面到底是如何运行的）

如果有一些确定好的任务，可以使用一个单线程将任务代码按顺序写进主线程依次执行。
要在线程运行过程中需要接收并执行新任务（来自线程内部），就需要采用事件循环机制。
* 引入循环机制：在线程语句最后添加一个for循环语句，线程会一直循环执行。
* 引入事件：在线程运行过程中，等待用户输入的信息，一旦接收到，线程会被激活并执行。

要接收其他线程发送过来的任务，就需要引入消息队列。消息队列是一种数据结构，可以存放要执行的任务。它符合队列“先进先出”的特点，也就是说要添加任务的话，添加到队列的尾部；要取出任务的话，从队列头部去取。

如果其他进程想发送任务给页面主线程，需要先通过IPC把任务发送给渲染进程的IO线程（相当于一个缓冲区），IO线程再把任务发送给页面主线程。

消息队列机制并不是太灵活，为了权衡执行效率和监控到实时性，引入了微任务。【分优先级处理任务】消息队列中的任务为宏任务，每个宏任务都包含了一个微任务队列，在执行宏任务过程中，如果DOM有变化，就会将该变化添加到微任务列表中，等宏任务主要功能执行完成后，渲染引擎会执行当前宏任务的微任务。【规避单个任务执行时间过久】JavaScript可以通过回调功能规避这种问题，让执行的JavaScript任务滞后执行。


